---
# MCP Server Plugin baseline rules (templates)
# Note: `source` should match the plugin's source name (placeholder: mcp_audit)
# Fields follow the `mcp.*` namespace as per requirements.

list:
  allowed_mcp_hosts:
    - "localhost"
    - "127.0.0.1"
    - "mcp.internal.local"

macros:
  - name: mcp_unapproved_host
    condition: not (mcp.server_host in (allowed_mcp_hosts))

rules:
  - rule: MCP Unapproved Endpoint Access
    desc: Detect access to MCP servers not in the allowlist
    condition: evt.source = mcp_audit and mcp_unapproved_host
    output: >-
      MCP unapproved endpoint access (host=%mcp.server_host port=%mcp.server_port
      client=%mcp.client_process session=%mcp.session_id)
    priority: WARNING
    source: mcp_audit

  - rule: MCP Insecure or Suspicious TLS
    desc: Detect plaintext or suspicious TLS for MCP connections
    condition: evt.source = mcp_audit and (mcp.tls=false or (mcp.cert_fingerprint != "" and mcp.cert_fingerprint != mcp.allowed_cert_fingerprint))
    output: >-
      MCP insecure/suspicious TLS (tls=%mcp.tls cert=%mcp.cert_fingerprint host=%mcp.server_host)
    priority: NOTICE
    source: mcp_audit

  - rule: MCP Excessive Data Transfer
    desc: Detect unusually large data transfers to MCP
    condition: evt.source = mcp_audit and (mcp.request_bytes > 10485760 or mcp.response_bytes > 10485760)
    output: >-
      MCP excessive data transfer (req=%mcp.request_bytes resp=%mcp.response_bytes method=%mcp.method)
    priority: WARNING
    source: mcp_audit

  - rule: MCP Excessive Tool Invocations
    desc: Detect unusually frequent tool invocations in a session
    condition: evt.source = mcp_audit and mcp.tool_invoke_count > 100
    output: >-
      MCP excessive tool invocations (count=%mcp.tool_invoke_count method=%mcp.method session=%mcp.session_id)
    priority: NOTICE
    source: mcp_audit

