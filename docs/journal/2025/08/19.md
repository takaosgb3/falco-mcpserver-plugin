# 開発日記 - 2025年08月19日（火）

## 📋 本日の作業概要
- 要件/計画/アーキ整備を完了し、監査Producer（wrap/proxy）と最小ルールを実装。CIはActionsランナーでのBuild＋軽量E2Eに統一。

## 🎯 完了したタスク
### 1. アーキ概要の再構成（OVERVIEW.md） ✅
- 背景/問題: 初稿は大雑把で参照性が低い。
- 対応/変更: MECEで構成（目的/前提/結論/構成/データ/フロー/非機能/導入/受入/リスク/次アクション）。ASCII図を追加。
- 結果/検証: 参照箇所が明確化し、INDEXからの導線で即時到達可能。

### 2. 監査Producer（wrap/proxy）実装 ✅
- 背景/問題: eBPFなしでリアルタイム観測が必要。
- 対応/変更: `mcp-audit-wrap`（stdio中継/バイト集計）と `mcp-audit-proxy`（tcp/ws透過）を追加。`pkg/audit/event.go` でJSONL出力。
- 結果/検証: ローカルで `--sink stdout` にてイベント出力を確認。

### 3. 最小ルール4本の整備 ✅
- 背景/問題: 検知要件（未承認/非TLS/大量/過剰）を早期に固定。
- 対応/変更: `rules/templates/mcp_baseline_rules.yaml` と `rules/mcp_baseline.yaml` を追加。
- 結果/検証: サンプルE2Eでフィールド整合を確認。

### 4. CI（Actionsランナー）初期整備 ✅
- 背景/問題: Pushでのノイズとパス不整合。
- 対応/変更: PR/手動トリガに限定、E2Eパス修正、ビルド/軽量E2Eを実行。
- 結果/検証: 安定完走。後続で可視化強化予定。

## 💡 重要な発見
- メタデータ中心の監査（内容非収集）で十分に運用可能。`server_host/tls/bytes/method(count)` の組み合わせで主要検知が成立。

## 🐛 解決した問題
- CI失敗（パス不整合）: E2E実行の相対パス修正で解消。

## 📊 現在のプロジェクト状態
- [PH-1] フェーズ1 完了（スキーマ/Producer最小/ルール/CI初期）
- [PH-2] フェーズ2 着手（stdioテストサーバ/統合テストの土台）

## 🔄 明日以降の予定
- [NX-1]/[P2-1.2] WSモード実装、[NX-2]/[P2-2.2] WS統合テスト追加。
- [NX-3]/[P2-3] `.method` 抽出/per-call出力（flagで有効化）。
- [NX-5]/[P2-4] Step Summary 集計強化（PASS/FAIL/SKIP）。

## 📝 メモ
- INDEXのクリックリンク＋1行サマリで参照性を確保。開発日記は日別ファイルに分割。
